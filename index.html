<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基于五运六气中医体质参考</title>
    <style>
        /* --- 基础样式 --- */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background-color: #f2f5f9; 
            margin: 0; 
            padding: 15px; 
            color: #333; 
        }
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: #fff; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
        }
        h1 { 
            text-align: center; 
            color: #1f8a70; 
            font-size: 22px; 
            margin-bottom: 25px; 
            font-weight: 700;
            border-bottom: 2px solid #e1e4e8;
            padding-bottom: 15px;
        }

        /* --- 表单样式 --- */
        .form-group { margin-bottom: 20px; }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600; 
            color: #4a5568; 
            font-size: 15px; 
        }
        
        .date-selector { 
            display: flex; 
            gap: 10px; 
        }
        
        select { 
            width: 100%; 
            padding: 12px 8px; 
            border: 1px solid #ced4da; 
            border-radius: 6px; 
            font-size: 16px; 
            background-color: #fff; 
            color: #495057;
        }
        
        button { 
            width: 100%; 
            padding: 14px; 
            background-color: #1f8a70; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 18px; 
            font-weight: bold; 
            cursor: pointer; 
            margin-top: 10px;
            box-shadow: 0 4px 6px rgba(31, 138, 112, 0.2);
            transition: background 0.2s;
        }
        button:active { background-color: #166650; transform: translateY(2px); }

        /* --- 结果区域样式 --- */
        .result-box { 
            margin-top: 30px; 
            padding: 20px; 
            background-color: #f0fffa; 
            border-radius: 10px; 
            border: 1px solid #b7ebdb;
            display: none; 
        }
        .result-item { 
            margin-bottom: 18px; 
            border-bottom: 1px dashed #c3e6cb; 
            padding-bottom: 12px; 
        }
        .result-item:last-child { border-bottom: none; }
        
        .result-title { 
            font-weight: bold; 
            color: #155724; 
            font-size: 16px; 
            margin-bottom: 8px;
            display: flex; 
            align-items: center;
        }
        .result-title::before {
            content: '';
            display: inline-block;
            width: 5px;
            height: 18px;
            background-color: #1f8a70;
            margin-right: 8px;
            border-radius: 3px;
        }
        
        .result-content { font-size: 15px; line-height: 1.6; color: #2d3748; }
        .medicine { color: #d63384; font-weight: 600; }
        
        /* 五行统计条 */
        .wuxing-bar { display: flex; margin-top: 10px; gap: 4px; height: 24px; border-radius: 4px; overflow: hidden;}
        .wuxing-item { 
            text-align: center; font-size: 12px; line-height: 24px; 
            color: #fff; font-weight: bold; 
            min-width: 20px;
        }
        .wx-wood { background-color: #28a745; }
        .wx-fire { background-color: #dc3545; }
        .wx-earth { background-color: #856404; }
        .wx-metal { background-color: #6c757d; }
        .wx-water { background-color: #007bff; }

        /* 八字排盘 */
        .bazi-display {
            display: flex;
            justify-content: space-around;
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin-bottom: 15px;
            text-align: center;
        }
        .pillar-title { font-size: 12px; color: #6c757d; margin-bottom: 4px; }
        .pillar-content { font-size: 20px; font-weight: bold; color: #343a40; }
        .zodiac-highlight { color: #e74c3c; font-weight: bold; }

        .note { font-size: 12px; color: #adb5bd; margin-top: 25px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h1>五运六气 · 中医先天体质参考</h1>
    
    <div class="form-group">
        <label>出生日期 (公历/阳历)</label>
        <div class="date-selector">
            <select id="selYear" onchange="updateDays()" style="flex: 1.3;"><option>年份</option></select>
            <select id="selMonth" onchange="updateDays()" style="flex: 1;"><option>月份</option></select>
            <select id="selDay" style="flex: 1;"><option>日期</option></select>
        </div>
    </div>

    <div class="form-group">
        <label>出生时间 (时辰)</label>
        <select id="birthHour">
            <option value="-1">不知道 / 忽略</option>
            <option value="23">子时 (23:00-01:00)</option>
            <option value="1">丑时 (01:00-03:00)</option>
            <option value="3">寅时 (03:00-05:00)</option>
            <option value="5">卯时 (05:00-07:00)</option>
            <option value="7">辰时 (07:00-09:00)</option>
            <option value="9">巳时 (09:00-11:00)</option>
            <option value="11">午时 (11:00-13:00)</option>
            <option value="13">未时 (13:00-15:00)</option>
            <option value="15">申时 (15:00-17:00)</option>
            <option value="17">酉时 (17:00-19:00)</option>
            <option value="19">戌时 (19:00-21:00)</option>
            <option value="21">亥时 (21:00-23:00)</option>
        </select>
    </div>

    <button onclick="calculate()">开始分析</button>

    <div id="result" class="result-box">
        <div class="result-item">
            <div class="result-title">生肖与五运</div>
            <div class="result-content" id="res_zodiac_desc"></div>
        </div>

        <div class="result-item">
            <div class="result-title">五运六气排盘</div>
            <div class="bazi-display" id="bazi_box"></div>
            
            <div class="result-title" style="margin-top: 15px;">五行能量统计 (基于五运六气)</div>
            <div class="wuxing-bar" id="wuxing_counts"></div>
            <div id="wuxing_desc" style="margin-top:10px; font-size:14px; color:#555;"></div>
        </div>

        <div class="result-item">
            <div class="result-title">出生月令分析 (主气)</div>
            <div class="result-content" id="res_month_analysis"></div>
        </div>

        <div class="result-item">
            <div class="result-title">先天体质类型</div>
            <div class="result-content" id="res_constitution"></div>
        </div>
        <div class="result-item">
            <div class="result-title">性格特征</div>
            <div class="result-content" id="res_traits"></div>
        </div>
        <div class="result-item">
            <div class="result-title">易患疾病</div>
            <div class="result-content" id="res_diseases"></div>
        </div>
        <div class="result-item">
            <div class="result-title">建议选方</div>
            <div class="result-content medicine" id="res_prescription"></div>
        </div>
        <div class="result-item">
            <div class="result-title">建议用药</div>
            <div class="result-content" id="res_drugs"></div>
        </div>
        <div class="result-item" id="hour_analysis_box">
            <div class="result-title">出生时辰分析</div>
            <div class="result-content" id="res_hour"></div>
        </div>
    </div>
    <div class="note">注：本工具依据《五运六气：中医精准诊疗解密》制作。<br>结果仅供参考，身体不适请务必就医。</div>
</div>

<script>
    // --- 数据常量 ---
    const TIAN_GAN = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
    const DI_ZHI = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
    
    const STEM_DESC = {
        4: "甲 (土太过 - 雨湿流行)", 5: "乙 (金不及 - 炎火乃行)", 
        6: "丙 (水太过 - 寒气流行)", 7: "丁 (木不及 - 燥金乃行)", 
        8: "戊 (火太过 - 炎暑流行)", 9: "己 (土不及 - 风气乃行)", 
        0: "庚 (金太过 - 燥气流行)", 1: "辛 (水不及 - 湿气乃行)", 
        2: "壬 (木太过 - 风气流行)", 3: "癸 (火不及 - 寒气乃行)"
    };

    const ZODIACS = {
        4: "鼠 (子)", 5: "牛 (丑)", 6: "虎 (寅)", 7: "兔 (卯)", 
        8: "龙 (辰)", 9: "蛇 (巳)", 10: "马 (午)", 11: "羊 (未)", 
        0: "猴 (申)", 1: "鸡 (酉)", 2: "狗 (戌)", 3: "猪 (亥)"
    };

    const GAN_WUXING = {
        "甲": "土", "己": "土", 
        "乙": "金", "庚": "金", 
        "丙": "水", "辛": "水", 
        "丁": "木", "壬": "木", 
        "戊": "火", "癸": "火"
    };

    const ZHI_WUXING = {
        "子": "火", "午": "火", 
        "丑": "土", "未": "土", 
        "寅": "火", "申": "火", 
        "卯": "金", "酉": "金", 
        "辰": "水", "戌": "水", 
        "巳": "木", "亥": "木"
    };

    // --- 初始化 ---
    function initDateSelectors() {
        const yearSelect = document.getElementById('selYear');
        const monthSelect = document.getElementById('selMonth');
        const currentYear = new Date().getFullYear();
        
        yearSelect.innerHTML = "";
        monthSelect.innerHTML = "";

        for (let y = currentYear; y >= 1920; y--) {
            let option = document.createElement("option");
            option.value = y;
            option.text = y + "年";
            yearSelect.add(option);
        }
        yearSelect.value = 1990;

        for (let m = 1; m <= 12; m++) {
            let option = document.createElement("option");
            option.value = m;
            option.text = m + "月";
            monthSelect.add(option);
        }
        updateDays(); 
    }

    function updateDays() {
        const year = parseInt(document.getElementById('selYear').value);
        const month = parseInt(document.getElementById('selMonth').value);
        const daySelect = document.getElementById('selDay');
        const currentDay = daySelect.value;
        const daysInMonth = new Date(year, month, 0).getDate();
        
        daySelect.innerHTML = "";
        for (let d = 1; d <= daysInMonth; d++) {
            let option = document.createElement("option");
            option.value = d;
            option.text = d + "日";
            daySelect.add(option);
        }
        if (currentDay > 0 && currentDay <= daysInMonth) {
            daySelect.value = currentDay;
        }
    }

    // --- 排盘算法 ---
    function getYearPillar(year) {
        let offset = year - 1984;
        let idx = offset % 60;
        if (idx < 0) idx += 60;
        return { gan: TIAN_GAN[idx % 10], zhi: DI_ZHI[idx % 12] };
    }

    function getMonthPillar(yearGan, month, day) {
        const cutoffs = [4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6]; 
        let zhiIndex = month == 1 ? ((day >= 6) ? 1 : 0) : 
                       month == 2 ? ((day >= 4) ? 2 : 1) : 
                       (day >= cutoffs[month - 1]) ? month : month - 1;
        if (zhiIndex > 11) zhiIndex = 0;
        
        const ganMap = {"甲":2, "己":2, "乙":4, "庚":4, "丙":6, "辛":6, "丁":8, "壬":8, "戊":0, "癸":0};
        let startGanIdx = ganMap[yearGan];
        let monthOffset = zhiIndex - 2; 
        if (monthOffset < 0) monthOffset += 12;
        let ganIdx = (startGanIdx + monthOffset) % 10;
        
        return { gan: TIAN_GAN[ganIdx], zhi: DI_ZHI[zhiIndex] };
    }

    function getDayPillar(year, month, day) {
        const base = new Date(2000, 0, 1);
        const target = new Date(year, month - 1, day);
        const diff = Math.floor((target - base) / (86400000));
        let idx = (54 + diff) % 60;
        if (idx < 0) idx += 60;
        return { gan: TIAN_GAN[idx % 10], zhi: DI_ZHI[idx % 12] };
    }

    function getHourPillar(dayGan, hour) {
        if (hour == -1) return { gan: "-", zhi: "-" };
        let zhiIdx = (hour >= 23 || hour < 1) ? 0 : Math.floor((parseInt(hour) + 1) / 2);
        const ganMap = {"甲":0, "己":0, "乙":2, "庚":2, "丙":4, "辛":4, "丁":6, "壬":6, "戊":8, "癸":8};
        let ganIdx = (ganMap[dayGan] + zhiIdx) % 10;
        return { gan: TIAN_GAN[ganIdx], zhi: DI_ZHI[zhiIdx] };
    }

    // --- 主计算函数 ---
    function calculate() {
        const year = parseInt(document.getElementById('selYear').value);
        const month = parseInt(document.getElementById('selMonth').value);
        const day = parseInt(document.getElementById('selDay').value);
        const hour = parseInt(document.getElementById('birthHour').value);

        // 1. 生肖与五运描述
        const lastDigit = year % 10;
        const branchMod = year % 12;
        const zodiacDesc = `<span class="zodiac-highlight">${year}年 (${STEM_DESC[lastDigit]})</span><br>生肖：<span class="zodiac-highlight">${ZODIACS[branchMod]}</span>`;
        document.getElementById('res_zodiac_desc').innerHTML = zodiacDesc;

        // 2. 排盘
        const yp = getYearPillar(year);
        const mp = getMonthPillar(yp.gan, month, day);
        const dp = getDayPillar(year, month, day);
        const hp = getHourPillar(dp.gan, hour);

        document.getElementById('bazi_box').innerHTML = `
            <div><div class="pillar-title">年柱</div><div class="pillar-content">${yp.gan}${yp.zhi}</div></div>
            <div><div class="pillar-title">月柱</div><div class="pillar-content">${mp.gan}${mp.zhi}</div></div>
            <div><div class="pillar-title">日柱</div><div class="pillar-content">${dp.gan}${dp.zhi}</div></div>
            <div><div class="pillar-title">时柱</div><div class="pillar-content">${hp.gan}${hp.zhi}</div></div>
        `;

        // 3. 五行统计
        let counts = { "金":0, "木":0, "水":0, "火":0, "土":0 };
        function add(g, z) {
            if (g !== "-") counts[GAN_WUXING[g]]++;
            if (z !== "-") counts[ZHI_WUXING[z]]++;
        }
        add(yp.gan, yp.zhi); add(mp.gan, mp.zhi);
        add(dp.gan, dp.zhi); add(hp.gan, hp.zhi);

        let barHtml = "";
        let total = Object.values(counts).reduce((a,b)=>a+b, 0);
        for (let t of ["木", "火", "土", "金", "水"]) {
            let v = counts[t];
            let color = t=="木"?"wx-wood": t=="火"?"wx-fire": t=="土"?"wx-earth": t=="金"?"wx-metal":"wx-water";
            if (v > 0) {
                 barHtml += `<div class="wuxing-item ${color}" style="flex:${v}">${t} ${v}</div>`;
            }
        }
        document.getElementById('wuxing_counts').innerHTML = barHtml || "<div style='text-align:center;width:100%'>无数据</div>";

        let maxVal = Math.max(...Object.values(counts));
        let maxTypes = Object.keys(counts).filter(k => counts[k] === maxVal);
        document.getElementById('wuxing_desc').innerHTML = `根据五运六气转化，您的命局中 <b>${maxTypes.join("、")}</b> 气最旺。`;

        // 4. 月份分析 (出生月令 - 气段判断)
        let md = month * 100 + day; // 例如 1月21日 = 121
        let monthText = "";
        
        // 简单的大寒到春分等节气划分，误差在1-2日内，符合书中简易推算原则
        // 1.21-3.21 初之气; 3.21-5.21 二之气 ...
        if (md >= 121 && md < 321) monthText = "初之气 (厥阴风木主令)<br>气候特征：风大，多风。 <br>健康提示：肝气较旺，易冲动，需注意疏肝理气。";
        else if (md >= 321 && md < 521) monthText = "二之气 (少阴君火主令)<br>气候特征：温暖，火热。 <br>健康提示：心火较旺，易患皮肤病、口疮，需注意养心清火。";
        else if (md >= 521 && md < 722) monthText = "三之气 (少阳相火主令)<br>气候特征：炎热，暑湿。 <br>健康提示：相火旺，怕热，易上火，需注意清热解暑。";
        else if (md >= 722 && md < 922) monthText = "四之气 (太阴湿土主令)<br>气候特征：潮湿，多雨。 <br>健康提示：脾胃较差，易胃寒、腹泻、关节炎，需注意健脾祛湿。";
        else if (md >= 922 && md < 1122) monthText = "五之气 (阳明燥金主令)<br>气候特征：干燥，凉爽。 <br>健康提示：大肠功能较差，易便秘或腹泻，易患颈椎病，需注意润燥。";
        else monthText = "终之气 (太阳寒水主令)<br>气候特征：寒冷，冰冻。 <br>健康提示：肾气弱，怕冷，易患关节炎、腰椎病，需注意温阳补肾。";
        
        // 1月1日-1月20日 属于上一年的终之气，做特殊处理
        if (md < 121) monthText = "终之气 (太阳寒水主令)<br>气候特征：寒冷，冰冻。 <br>健康提示：肾气弱，怕冷，易患关节炎、腰椎病，需注意温阳补肾。";

        document.getElementById('res_month_analysis').innerHTML = monthText;

        // 5. 体质判断
        let constitution = {};
        if (branchMod === 9 || branchMod === 3) { 
            constitution = {
                type: "风性体质 (厥阴风木)",
                traits: "性子急，做事风风火火，真诚友善，逻辑思维强。属蛇者情绪多变，属猪者贪图享受。",
                diseases: "易患咽喉肿痛、牙痛、头痛、肾虚、颈腰椎痛、心血管疾病。",
                prescription: "柴芩仙杜理中汤",
                drugs: "柴胡、黄芩、威灵仙、杜仲、党参、白术、甘草、干姜"
            };
        } else if (branchMod === 4 || branchMod === 10) { 
            constitution = {
                type: "热性体质 (少阴君火)",
                traits: "讲义气，性子急，有时顶撞领导但对下级好。属鼠敏感多疑，属马心高气傲。",
                diseases: "易患膀胱、耳道、眼疾、心血管病、皮肤病、牙痛、肠道疾病。",
                prescription: "黄芩丹皮汤",
                drugs: "黄芩、牡丹皮、地黄、白芍、玄参、黄芪、麦冬、蒲黄、姜黄"
            };
        } else if (branchMod === 6 || branchMod === 0) { 
            constitution = {
                type: "火性体质 (少阳相火)",
                traits: "热情好客，外向爱运动，喜旅游，心性散漫。属虎占有欲强，属猴情商较低。",
                diseases: "易患四肢关节炎、胆囊炎、脱发、大肠病、肺病、甲状腺肿大。",
                prescription: "柴芍四黄汤",
                drugs: "柴胡、白芍、黄芩、黄芪、蒲黄、姜黄、白术、枳壳、麦冬、瓜蒌"
            };
        } else if (branchMod === 5 || branchMod === 11) { 
            constitution = {
                type: "湿性体质 (太阴湿土)",
                traits: "诚实守信，吃苦耐劳，固执较真，爱整洁，完美主义。多内寒外热。",
                diseases: "脾胃差，易腹泻、结肠炎、脊柱病、甲状腺/乳腺问题、妇科病。",
                prescription: "术甘苓泽汤",
                drugs: "白术、甘草、茯苓、泽泻、柴胡、黄芩、蒲黄、姜黄"
            };
        } else if (branchMod === 7 || branchMod === 1) { 
            constitution = {
                type: "燥性体质 (阳明燥金)",
                traits: "待人热情，乐观低调，有艺术修养，但有时狂躁固执。属兔多愁善感。",
                diseases: "易患肝病、四肢毛发病、骨骼病、呼吸系统病、牙痛、咽喉炎、便秘。",
                prescription: "黄芪麦冬汤",
                drugs: "黄芪、麦冬、厚朴、黄芩、薏米、葛根、蒲黄、姜黄、蜂房、地黄、白术、枳壳"
            };
        } else if (branchMod === 8 || branchMod === 2) { 
            constitution = {
                type: "寒性体质 (太阳寒水)",
                traits: "倔强刚强，外冷内热，好打抱不平，好辩论。属龙唯我独尊，属狗固执。",
                diseases: "易患腰腿痛、强直性脊柱炎、胃病、皮肤肌肉痛、妇科病。多内寒外热。",
                prescription: "四逆柴桂汤",
                drugs: "淡附子、炙甘草、干姜、党参、茯苓、木瓜、柴胡、黄芩、桂枝、白术"
            };
        }

        // 时辰分析
        let hourText = "";
        const hourMap = {
            "23": "子时 (胆经)：胆火旺，应深睡。", "1": "丑时 (肝经)：肝火旺，应熟睡。", 
            "3": "寅时 (肺经)：肺气虚易醒。", "5": "卯时 (大肠经)：宜排便。", 
            "7": "辰时 (胃经)：宜早餐。", "9": "巳时 (脾经)：脾弱易疲。", 
            "11": "午时 (心经)：宜小憩。", "13": "未时 (小肠经)：消化弱。", 
            "15": "申时 (膀胱经)：多喝水。", "17": "酉时 (肾经)：肾虚易乏。", 
            "19": "戌时 (心包经)：宜放松。", "21": "亥时 (三焦经)：宜入睡。"
        };
        if (hour != -1 && hourMap[hour]) hourText = hourMap[hour];

        // 填充页面
        document.getElementById('res_constitution').innerText = constitution.type;
        document.getElementById('res_traits').innerText = constitution.traits;
        document.getElementById('res_diseases').innerText = constitution.diseases;
        document.getElementById('res_prescription').innerText = constitution.prescription;
        document.getElementById('res_drugs').innerText = constitution.drugs;
        
        let hBox = document.getElementById('hour_analysis_box');
        if (hourText) { hBox.style.display = 'block'; document.getElementById('res_hour').innerText = hourText; }
        else { hBox.style.display = 'none'; }

        let rBox = document.getElementById('result');
        rBox.style.display = 'block';
        rBox.scrollIntoView({behavior: 'smooth'});
    }

    initDateSelectors();
    window.onload = initDateSelectors;
</script>

</body>
</html>


